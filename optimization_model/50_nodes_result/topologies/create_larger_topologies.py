import json
import os

topologySizes = [
    {
        "size": 20,
        "vDUs": [6, 7, 13, 14, 18, 19],
        "core": [0],
        "CU": [1],
        "transport": [2, 3, 4, 5, 8, 9, 
                      10, 11, 12, 15, 16, 17],
        "links": [[0, 1], [1, 2], [2, 3], [3, 4], [4, 5], [5, 6], [5, 7],
                  [3, 8],
                  [2, 8], [8, 9], [9, 10], [10, 11], [11, 12], [12, 13], [12, 14],
                  [10, 15], [15, 16], [16, 17], [17, 18], [17, 19]]
    },
    {
        "size": 30,
        "vDUs": [10, 11, 16, 17, 23, 24, 28, 29],
        "core": [0],
        "CU": [1],
        "transport": [2, 3, 4, 5, 6, 7, 8, 9,
                      12, 13, 14, 15, 18, 19,
                      20, 21, 22, 25, 26, 27],
        "links": [[0, 1], [1, 2], [2, 3], [3, 4], [4, 5], [5, 6], [6, 7], [7, 8], [8, 9], [9, 10], [9, 11],
                  [3, 18],
                  [5, 12], [12, 13], [13, 14], [14, 15], [15, 16], [15, 17],
                  [2, 18], [18, 19], [19, 20], [20, 21], [21, 22], [22, 23], [22, 24],
                  [20, 25], [25, 26], [26, 27], [27, 28], [27, 29]]
    },
    {
        "size": 40,
        "vDUs": [10, 11, 20, 21, 26, 27, 33, 34, 38, 39],
        "core": [0],
        "CU": [1],
        "transport": [2, 3, 4, 5, 6, 7, 8, 9,
                      12, 13, 14, 15, 16, 17, 18, 19,
                      22, 23, 24, 25, 28, 29,
                      30, 31, 32, 35, 36, 37],
        "links": [[0, 1], [1, 2], [2, 3], [3, 4], [4, 5], [5, 6], [6, 7], [7, 8], [8, 9], [9, 10], [9, 11],
                  [3, 28],
                  [5, 12], [12, 13], [13, 14], [14, 15], [15, 16], [16, 17], [17, 18], [18, 19], [19, 20], [19, 21],
                  [15, 22], [22, 23], [23, 24], [24, 25], [25, 26], [25, 27],
                  [2, 28], [28, 29], [29, 30], [30, 31], [31, 32], [32, 33], [32, 34],
                  [30, 35], [35, 36], [36, 37], [37, 38], [38, 39]]
    },
    {
        "size": 50,
        "vDUs": [10, 11, 20, 21, 26, 27, 33, 34, 42, 43, 48, 49],
        "core": [0],
        "CU": [1],
        "transport": [2, 3, 4, 5, 6, 7, 8, 9,
                      12, 13, 14, 15, 16, 17, 18, 19,
                      22, 23, 24, 25, 28, 29,
                      30, 31, 32, 35, 36, 37, 38, 39, 
                      40, 41, 44, 45, 46, 47],
        "links": [[0, 1], [1, 2], [2, 3], [3, 4], [4, 5], [5, 6], [6, 7], [7, 8], [8, 9], [9, 10], [9, 11],
                  [3, 28],
                  [5, 12], [12, 13], [13, 14], [14, 15], [15, 16], [16, 17], [17, 18], [18, 19], [19, 20], [19, 21],
                  [15, 22], [22, 23], [23, 24], [24, 25], [25, 26], [25, 27],
                  [2, 28], [28, 29], [29, 30], [30, 31], [31, 32], [32, 33], [32, 34],
                  [30, 35], [35, 36], [36, 37], [37, 38], [38, 39], [39, 40], [40, 41], [41, 42], [41, 43],
                  [37, 44], [44, 45], [45, 46], [46, 47], [47, 48], [47, 49]]
    },
    {
        "size": 60,
        "vDUs": [10, 11, 20, 21, 26, 27, 37, 38, 43, 44, 52, 53, 58, 59],
        "core": [0],
        "CU": [1],
        "transport": [2, 3, 4, 5, 6, 7, 8, 9,
                      12, 13, 14, 15, 16, 17, 18, 19,
                      22, 23, 24, 25, 28, 29, 
                      30, 31, 32, 33, 34, 35, 36, 39, 
                      40, 41, 42, 45, 46, 47, 48, 49, 
                      50, 51, 54, 55, 56, 57],
        "links": [[0, 1], [1, 2], [2, 3], [3, 4], [4, 5], [5, 6], [6, 7], [7, 8], [8, 9], [9, 10], [9, 11],
                  [3, 28],
                  [5, 12], [12, 13], [13, 14], [14, 15], [15, 16], [16, 17], [17, 18], [18, 19], [19, 20], [19, 21],
                  [15, 22], [22, 23], [23, 24], [24, 25], [25, 26], [25, 27],
                  [2, 28], [28, 29], [29, 30], [30, 31], [31, 32], [32, 33], [33, 34], [34, 35], [35, 36], [36, 37], [36, 38],
                  [32, 39], [39, 40], [40, 41], [41, 42], [42, 43], [42, 44],
                  [30, 45], [45, 46], [46, 47], [47, 48], [48, 49], [49, 50], [50, 51],
                  [51, 52], [51, 53],
                  [47, 54], [54, 55], [55, 56], [56, 57], [57, 58], [57, 59]]
    }
]

for topologySize in topologySizes:
    nodes = []
    DUs = []
    duID = 0
    
    for ID in range(topologySize["size"]):
        if ID in topologySize["core"]:
            nodes.append({
                "ID": ID,
                "cpu": 0,
                "RAM": 0,
                "R": 0,
                "T": 0
            })
        elif ID in topologySize["CU"]:
            nodes.append({
                "ID": ID,
                "cpu": 1024,
                "RAM": 512,
                "R": 12,
                "T": 0.000000387,
                "cost": 0.017
            })
        elif ID in topologySize["transport"]:
            nodes.append({
                "ID": ID,
                "cpu": 0,
                "RAM": 0,
                "R": 8,
                "T": 0.000000387
            })

        elif ID in topologySize["vDUs"]:
            nodes.append({
                "ID": ID,
                "cpu": 128,
                "RAM": 128,
                "R": 2,
                "T": 0.000006442,
                "cost": 1
            })
            DUs.append({
                "ID": duID,
                "node": ID
            })
            duID += 1

    links = []
    for link in topologySize["links"]:
        links.append({
            "from_Node": link[0],
            "to_Node": link[1],
            "delay": 0.127,
            "bw": 10
        })

    dir_name = "topology_{}_vDUs_{}_nodes".format(len(topologySize["vDUs"]), topologySize["size"])
    if not os.path.exists(dir_name):
        os.makedirs(dir_name)
    
    json.dump({"nodes": nodes, "DUs": DUs, "links": links}, 
                open("{}/{}.json".format(dir_name, dir_name), "w"), indent=2)